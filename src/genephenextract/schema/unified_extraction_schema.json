{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Unified Genotype-Phenotype Extraction Schema",
  "description": "Supports both cohort-level (aggregate counts) and individual-level (detailed pedigrees) data extraction",
  "type": "object",
  "properties": {
    "extraction_type": {
      "type": "string",
      "enum": ["cohort", "individual"],
      "description": "Use 'cohort' for aggregate counts, 'individual' for detailed patient data"
    },
    "gene": {
      "type": "string",
      "description": "Primary gene discussed (e.g., KCNH2, SCN5A)"
    },
    "cohort_data": {
      "type": "array",
      "description": "Use this when paper reports AGGREGATE COUNTS (e.g., '50 patients, 35 had phenotype X')",
      "items": {
        "type": "object",
        "properties": {
          "variant": {
            "type": "string",
            "description": "Specific variant if mentioned, null if multiple variants in cohort"
          },
          "genotype": {
            "type": "string",
            "enum": ["heterozygous", "homozygous", "compound_heterozygous", "wild-type"],
            "description": "Genotype of carriers in this cohort"
          },
          "total_carriers": {
            "type": "integer",
            "description": "Total number of carriers with this genotype",
            "minimum": 1
          },
          "phenotype_counts": {
            "type": "array",
            "description": "For each phenotype, how many carriers had it",
            "items": {
              "type": "object",
              "properties": {
                "phenotype": {
                  "type": "string",
                  "description": "Name of the phenotype"
                },
                "affected_count": {
                  "type": "integer",
                  "description": "Number of carriers with this phenotype",
                  "minimum": 0
                },
                "notes": {
                  "type": "string",
                  "description": "Optional notes about this phenotype observation"
                }
              },
              "required": ["phenotype", "affected_count"]
            }
          },
          "population": {
            "type": "string",
            "description": "Description of cohort (e.g., 'probands', 'family members', 'unrelated cases')"
          },
          "notes": {
            "type": "string",
            "description": "Any additional relevant information"
          }
        },
        "required": ["genotype", "total_carriers", "phenotype_counts"]
      }
    },
    "individual_data": {
      "type": "array",
      "description": "Use this when paper reports INDIVIDUAL PATIENTS with detailed characteristics",
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "Patient identifier (e.g., 'proband', 'II-3', 'patient 1', 'mother')"
          },
          "variant": {
            "type": "string",
            "description": "Specific variant this individual carries"
          },
          "genotype": {
            "type": "string",
            "enum": ["heterozygous", "homozygous", "compound_heterozygous", "wild-type"],
            "description": "This individual's genotype"
          },
          "affected": {
            "type": "boolean",
            "description": "true if individual has disease-related phenotypes, false if asymptomatic carrier"
          },
          "phenotypes": {
            "type": "array",
            "description": "List of phenotypes observed in this individual (empty array if unaffected)",
            "items": {
              "type": "object",
              "properties": {
                "phenotype": {
                  "type": "string",
                  "description": "Name of the phenotype"
                },
                "severity": {
                  "type": "string",
                  "description": "Severity if mentioned (mild, moderate, severe)"
                },
                "notes": {
                  "type": "string",
                  "description": "Additional details about this phenotype"
                }
              },
              "required": ["phenotype"]
            }
          },
          "age": {
            "type": "number",
            "description": "Current age in years"
          },
          "sex": {
            "type": "string",
            "enum": ["male", "female", "unknown"],
            "description": "Biological sex"
          },
          "age_at_onset": {
            "type": "number",
            "description": "Age when symptoms first appeared (years)"
          },
          "age_at_diagnosis": {
            "type": "number",
            "description": "Age when diagnosed (years)"
          },
          "relation": {
            "type": "string",
            "description": "Relationship to proband (e.g., 'proband', 'mother', 'father', 'sibling')"
          },
          "notes": {
            "type": "string",
            "description": "Any additional relevant information"
          }
        },
        "required": ["id", "genotype"]
      }
    }
  },
  "required": ["extraction_type", "gene"],
  "oneOf": [
    {
      "properties": {
        "extraction_type": { "const": "cohort" }
      },
      "required": ["cohort_data"]
    },
    {
      "properties": {
        "extraction_type": { "const": "individual" }
      },
      "required": ["individual_data"]
    }
  ]
}
